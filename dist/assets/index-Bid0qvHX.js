import{Z as p,S as Er,z as l}from"./index-CRwBhgXv.js";import"./index-CjVg0o4A.js";var Ar=Symbol.for("vercel.ai.validator");const Pr=Symbol("Let zodToJsonSchema decide on which parser to use"),Nr={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},Mr=e=>({...Nr,...e}),Rr=e=>{const t=Mr(e),r=t.name!==void 0?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([n,a])=>[a._def,{def:a._def,path:[...t.basePath,t.definitionPath,n],jsonSchema:void 0}]))}};function At(e,t,r,n){n!=null&&n.errorMessages&&r&&(e.errorMessage={...e.errorMessage,[t]:r})}function g(e,t,r,n,a){e[t]=r,At(e,t,n,a)}function Cr(){return{}}function Or(e,t){var n,a;const r={type:"array"};return((a=(n=e.type)==null?void 0:n._def)==null?void 0:a.typeName)!==p.ZodAny&&(r.items=d(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&g(r,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&g(r,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(g(r,"minItems",e.exactLength.value,e.exactLength.message,t),g(r,"maxItems",e.exactLength.value,e.exactLength.message,t)),r}function jr(e,t){const r={type:"integer",format:"int64"};if(!e.checks)return r;for(const n of e.checks)switch(n.kind){case"min":t.target==="jsonSchema7"?n.inclusive?g(r,"minimum",n.value,n.message,t):g(r,"exclusiveMinimum",n.value,n.message,t):(n.inclusive||(r.exclusiveMinimum=!0),g(r,"minimum",n.value,n.message,t));break;case"max":t.target==="jsonSchema7"?n.inclusive?g(r,"maximum",n.value,n.message,t):g(r,"exclusiveMaximum",n.value,n.message,t):(n.inclusive||(r.exclusiveMaximum=!0),g(r,"maximum",n.value,n.message,t));break;case"multipleOf":g(r,"multipleOf",n.value,n.message,t);break}return r}function $r(){return{type:"boolean"}}function Dr(e,t){return d(e.type._def,t)}const Zr=(e,t)=>d(e.innerType._def,t);function Pt(e,t,r){const n=r??t.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((a,o)=>Pt(e,t,a))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Ur(e,t)}}const Ur=(e,t)=>{const r={type:"integer",format:"unix-time"};if(t.target==="openApi3")return r;for(const n of e.checks)switch(n.kind){case"min":g(r,"minimum",n.value,n.message,t);break;case"max":g(r,"maximum",n.value,n.message,t);break}return r};function Lr(e,t){return{...d(e.innerType._def,t),default:e.defaultValue()}}function Br(e,t){return t.effectStrategy==="input"?d(e.schema._def,t):{}}function Vr(e){return{type:"string",enum:e.values}}const Jr=e=>"type"in e&&e.type==="string"?!1:"allOf"in e;function qr(e,t){const r=[d(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),d(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(o=>!!o);let n=t.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const a=[];return r.forEach(o=>{if(Jr(o))a.push(...o.allOf),o.unevaluatedProperties===void 0&&(n=void 0);else{let s=o;if("additionalProperties"in o&&o.additionalProperties===!1){const{additionalProperties:i,...c}=o;s=c}else n=void 0;a.push(s)}}),a.length?{allOf:a,...n}:void 0}function zr(e,t){const r=typeof e.value;return r!=="bigint"&&r!=="number"&&r!=="boolean"&&r!=="string"?{type:Array.isArray(e.value)?"array":"object"}:t.target==="openApi3"?{type:r==="bigint"?"integer":r,enum:[e.value]}:{type:r==="bigint"?"integer":r,const:e.value}}let ve;const N={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(ve===void 0&&(ve=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),ve),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function Nt(e,t){const r={type:"string"};function n(a){return t.patternStrategy==="escape"?Fr(a):a}if(e.checks)for(const a of e.checks)switch(a.kind){case"min":g(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,a.value):a.value,a.message,t);break;case"max":g(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,a.value):a.value,a.message,t);break;case"email":switch(t.emailStrategy){case"format:email":x(r,"email",a.message,t);break;case"format:idn-email":x(r,"idn-email",a.message,t);break;case"pattern:zod":S(r,N.email,a.message,t);break}break;case"url":x(r,"uri",a.message,t);break;case"uuid":x(r,"uuid",a.message,t);break;case"regex":S(r,a.regex,a.message,t);break;case"cuid":S(r,N.cuid,a.message,t);break;case"cuid2":S(r,N.cuid2,a.message,t);break;case"startsWith":S(r,RegExp(`^${n(a.value)}`),a.message,t);break;case"endsWith":S(r,RegExp(`${n(a.value)}$`),a.message,t);break;case"datetime":x(r,"date-time",a.message,t);break;case"date":x(r,"date",a.message,t);break;case"time":x(r,"time",a.message,t);break;case"duration":x(r,"duration",a.message,t);break;case"length":g(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,a.value):a.value,a.message,t),g(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,a.value):a.value,a.message,t);break;case"includes":{S(r,RegExp(n(a.value)),a.message,t);break}case"ip":{a.version!=="v6"&&x(r,"ipv4",a.message,t),a.version!=="v4"&&x(r,"ipv6",a.message,t);break}case"emoji":S(r,N.emoji,a.message,t);break;case"ulid":{S(r,N.ulid,a.message,t);break}case"base64":{switch(t.base64Strategy){case"format:binary":{x(r,"binary",a.message,t);break}case"contentEncoding:base64":{g(r,"contentEncoding","base64",a.message,t);break}case"pattern:zod":{S(r,N.base64,a.message,t);break}}break}case"nanoid":S(r,N.nanoid,a.message,t)}return r}const Fr=e=>Array.from(e).map(t=>/[a-zA-Z0-9]/.test(t)?t:`\\${t}`).join(""),x=(e,t,r,n)=>{var a;e.format||(a=e.anyOf)!=null&&a.some(o=>o.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&n.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.anyOf.push({format:t,...r&&n.errorMessages&&{errorMessage:{format:r}}})):g(e,"format",t,r,n)},S=(e,t,r,n)=>{var a;e.pattern||(a=e.allOf)!=null&&a.some(o=>o.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&n.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.allOf.push({pattern:ft(t,n),...r&&n.errorMessages&&{errorMessage:{pattern:r}}})):g(e,"pattern",ft(t,n),r,n)},ft=(e,t)=>{var f;const r=typeof e=="function"?e():e;if(!t.applyRegexFlags||!r.flags)return r.source;const n={i:r.flags.includes("i"),m:r.flags.includes("m"),s:r.flags.includes("s")},a=n.i?r.source.toLowerCase():r.source;let o="",s=!1,i=!1,c=!1;for(let u=0;u<a.length;u++){if(s){o+=a[u],s=!1;continue}if(n.i){if(i){if(a[u].match(/[a-z]/)){c?(o+=a[u],o+=`${a[u-2]}-${a[u]}`.toUpperCase(),c=!1):a[u+1]==="-"&&((f=a[u+2])!=null&&f.match(/[a-z]/))?(o+=a[u],c=!0):o+=`${a[u]}${a[u].toUpperCase()}`;continue}}else if(a[u].match(/[a-z]/)){o+=`[${a[u]}${a[u].toUpperCase()}]`;continue}}if(n.m){if(a[u]==="^"){o+=`(^|(?<=[\r
]))`;continue}else if(a[u]==="$"){o+=`($|(?=[\r
]))`;continue}}if(n.s&&a[u]==="."){o+=i?`${a[u]}\r
`:`[${a[u]}\r
]`;continue}o+=a[u],a[u]==="\\"?s=!0:i&&a[u]==="]"?i=!1:!i&&a[u]==="["&&(i=!0)}try{const u=new RegExp(o)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),r.source}return o};function Mt(e,t){var n,a,o,s;if(t.target==="openApi3"&&((n=e.keyType)==null?void 0:n._def.typeName)===p.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((i,c)=>({...i,[c]:d(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",c]})??{}}),{}),additionalProperties:!1};const r={type:"object",additionalProperties:d(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??{}};if(t.target==="openApi3")return r;if(((a=e.keyType)==null?void 0:a._def.typeName)===p.ZodString&&((o=e.keyType._def.checks)!=null&&o.length)){const i=Object.entries(Nt(e.keyType._def,t)).reduce((c,[f,u])=>f==="type"?c:{...c,[f]:u},{});return{...r,propertyNames:i}}else if(((s=e.keyType)==null?void 0:s._def.typeName)===p.ZodEnum)return{...r,propertyNames:{enum:e.keyType._def.values}};return r}function Gr(e,t){if(t.mapStrategy==="record")return Mt(e,t);const r=d(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||{},n=d(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[r,n],minItems:2,maxItems:2}}}function Kr(e){const t=e.values,n=Object.keys(e.values).filter(o=>typeof t[t[o]]!="number").map(o=>t[o]),a=Array.from(new Set(n.map(o=>typeof o)));return{type:a.length===1?a[0]==="string"?"string":"number":["string","number"],enum:n}}function Wr(){return{not:{}}}function Hr(e){return e.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const de={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function Xr(e,t){if(t.target==="openApi3")return gt(e,t);const r=e.options instanceof Map?Array.from(e.options.values()):e.options;if(r.every(n=>n._def.typeName in de&&(!n._def.checks||!n._def.checks.length))){const n=r.reduce((a,o)=>{const s=de[o._def.typeName];return s&&!a.includes(s)?[...a,s]:a},[]);return{type:n.length>1?n:n[0]}}else if(r.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){const n=r.reduce((a,o)=>{const s=typeof o._def.value;switch(s){case"string":case"number":case"boolean":return[...a,s];case"bigint":return[...a,"integer"];case"object":if(o._def.value===null)return[...a,"null"];case"symbol":case"undefined":case"function":default:return a}},[]);if(n.length===r.length){const a=n.filter((o,s,i)=>i.indexOf(o)===s);return{type:a.length>1?a:a[0],enum:r.reduce((o,s)=>o.includes(s._def.value)?o:[...o,s._def.value],[])}}}else if(r.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:r.reduce((n,a)=>[...n,...a._def.values.filter(o=>!n.includes(o))],[])};return gt(e,t)}const gt=(e,t)=>{const r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((n,a)=>d(n._def,{...t,currentPath:[...t.currentPath,"anyOf",`${a}`]})).filter(n=>!!n&&(!t.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return r.length?{anyOf:r}:void 0};function Yr(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return t.target==="openApi3"?{type:de[e.innerType._def.typeName],nullable:!0}:{type:[de[e.innerType._def.typeName],"null"]};if(t.target==="openApi3"){const n=d(e.innerType._def,{...t,currentPath:[...t.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const r=d(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}function Qr(e,t){const r={type:"number"};if(!e.checks)return r;for(const n of e.checks)switch(n.kind){case"int":r.type="integer",At(r,"type",n.message,t);break;case"min":t.target==="jsonSchema7"?n.inclusive?g(r,"minimum",n.value,n.message,t):g(r,"exclusiveMinimum",n.value,n.message,t):(n.inclusive||(r.exclusiveMinimum=!0),g(r,"minimum",n.value,n.message,t));break;case"max":t.target==="jsonSchema7"?n.inclusive?g(r,"maximum",n.value,n.message,t):g(r,"exclusiveMaximum",n.value,n.message,t):(n.inclusive||(r.exclusiveMaximum=!0),g(r,"maximum",n.value,n.message,t));break;case"multipleOf":g(r,"multipleOf",n.value,n.message,t);break}return r}function en(e,t){return t.removeAdditionalStrategy==="strict"?e.catchall._def.typeName==="ZodNever"?e.unknownKeys!=="strict":d(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0:e.catchall._def.typeName==="ZodNever"?e.unknownKeys==="passthrough":d(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0}function tn(e,t){const r={type:"object",...Object.entries(e.shape()).reduce((n,[a,o])=>{if(o===void 0||o._def===void 0)return n;const s=d(o._def,{...t,currentPath:[...t.currentPath,"properties",a],propertyPath:[...t.currentPath,"properties",a]});return s===void 0?n:{properties:{...n.properties,[a]:s},required:o.isOptional()?n.required:[...n.required,a]}},{properties:{},required:[]}),additionalProperties:en(e,t)};return r.required.length||delete r.required,r}const rn=(e,t)=>{var n;if(t.currentPath.toString()===((n=t.propertyPath)==null?void 0:n.toString()))return d(e.innerType._def,t);const r=d(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return r?{anyOf:[{not:{}},r]}:{}},nn=(e,t)=>{if(t.pipeStrategy==="input")return d(e.in._def,t);if(t.pipeStrategy==="output")return d(e.out._def,t);const r=d(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),n=d(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,n].filter(a=>a!==void 0)}};function an(e,t){return d(e.type._def,t)}function on(e,t){const n={type:"array",uniqueItems:!0,items:d(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&g(n,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&g(n,"maxItems",e.maxSize.value,e.maxSize.message,t),n}function sn(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((r,n)=>d(r._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[]),additionalItems:d(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((r,n)=>d(r._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[])}}function un(){return{not:{}}}function ln(){return{}}const cn=(e,t)=>d(e.innerType._def,t);function d(e,t,r=!1){var s;const n=t.seen.get(e);if(t.override){const i=(s=t.override)==null?void 0:s.call(t,e,t,n,r);if(i!==Pr)return i}if(n&&!r){const i=pn(n,t);if(i!==void 0)return i}const a={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,a);const o=dn(e,e.typeName,t);return o&&fn(e,t,o),a.jsonSchema=o,o}const pn=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:mn(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((r,n)=>t.currentPath[n]===r)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{}):t.$refStrategy==="seen"?{}:void 0}},mn=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")},dn=(e,t,r)=>{switch(t){case p.ZodString:return Nt(e,r);case p.ZodNumber:return Qr(e,r);case p.ZodObject:return tn(e,r);case p.ZodBigInt:return jr(e,r);case p.ZodBoolean:return $r();case p.ZodDate:return Pt(e,r);case p.ZodUndefined:return un();case p.ZodNull:return Hr(r);case p.ZodArray:return Or(e,r);case p.ZodUnion:case p.ZodDiscriminatedUnion:return Xr(e,r);case p.ZodIntersection:return qr(e,r);case p.ZodTuple:return sn(e,r);case p.ZodRecord:return Mt(e,r);case p.ZodLiteral:return zr(e,r);case p.ZodEnum:return Vr(e);case p.ZodNativeEnum:return Kr(e);case p.ZodNullable:return Yr(e,r);case p.ZodOptional:return rn(e,r);case p.ZodMap:return Gr(e,r);case p.ZodSet:return on(e,r);case p.ZodLazy:return d(e.getter()._def,r);case p.ZodPromise:return an(e,r);case p.ZodNaN:case p.ZodNever:return Wr();case p.ZodEffects:return Br(e,r);case p.ZodAny:return Cr();case p.ZodUnknown:return ln();case p.ZodDefault:return Lr(e,r);case p.ZodBranded:return Dr(e,r);case p.ZodReadonly:return cn(e,r);case p.ZodCatch:return Zr(e,r);case p.ZodPipeline:return nn(e,r);case p.ZodFunction:case p.ZodVoid:case p.ZodSymbol:return;default:return(n=>{})()}},fn=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r),gn=(e,t)=>{const r=Rr(t),n=void 0,a=t==null?void 0:t.name,o=d(e._def,r,!1)??{},s=a===void 0?n?{...o,[r.definitionPath]:n}:o:{$ref:[...r.$refStrategy==="relative"?[]:r.basePath,r.definitionPath,a].join("/"),[r.definitionPath]:{...n,[a]:o}};return r.target==="jsonSchema7"?s.$schema="http://json-schema.org/draft-07/schema#":r.target==="jsonSchema2019-09"&&(s.$schema="https://json-schema.org/draft/2019-09/schema#"),s};var q={code:"0",name:"text",parse:e=>{if(typeof e!="string")throw new Error('"text" parts expect a string value.');return{type:"text",value:e}}},z={code:"1",name:"function_call",parse:e=>{if(e==null||typeof e!="object"||!("function_call"in e)||typeof e.function_call!="object"||e.function_call==null||!("name"in e.function_call)||!("arguments"in e.function_call)||typeof e.function_call.name!="string"||typeof e.function_call.arguments!="string")throw new Error('"function_call" parts expect an object with a "function_call" property.');return{type:"function_call",value:e}}},F={code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw new Error('"data" parts expect an array value.');return{type:"data",value:e}}},G={code:"3",name:"error",parse:e=>{if(typeof e!="string")throw new Error('"error" parts expect a string value.');return{type:"error",value:e}}},K={code:"4",name:"assistant_message",parse:e=>{if(e==null||typeof e!="object"||!("id"in e)||!("role"in e)||!("content"in e)||typeof e.id!="string"||typeof e.role!="string"||e.role!=="assistant"||!Array.isArray(e.content)||!e.content.every(t=>t!=null&&typeof t=="object"&&"type"in t&&t.type==="text"&&"text"in t&&t.text!=null&&typeof t.text=="object"&&"value"in t.text&&typeof t.text.value=="string"))throw new Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},W={code:"5",name:"assistant_control_data",parse:e=>{if(e==null||typeof e!="object"||!("threadId"in e)||!("messageId"in e)||typeof e.threadId!="string"||typeof e.messageId!="string")throw new Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},H={code:"6",name:"data_message",parse:e=>{if(e==null||typeof e!="object"||!("role"in e)||!("data"in e)||typeof e.role!="string"||e.role!=="data")throw new Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}},X={code:"7",name:"tool_calls",parse:e=>{if(e==null||typeof e!="object"||!("tool_calls"in e)||typeof e.tool_calls!="object"||e.tool_calls==null||!Array.isArray(e.tool_calls)||e.tool_calls.some(t=>t==null||typeof t!="object"||!("id"in t)||typeof t.id!="string"||!("type"in t)||typeof t.type!="string"||!("function"in t)||t.function==null||typeof t.function!="object"||!("arguments"in t.function)||typeof t.function.name!="string"||typeof t.function.arguments!="string"))throw new Error('"tool_calls" parts expect an object with a ToolCallPayload.');return{type:"tool_calls",value:e}}},Y={code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw new Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},Q={code:"9",name:"tool_call",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("toolName"in e)||typeof e.toolName!="string"||!("args"in e)||typeof e.args!="object")throw new Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:e}}},ee={code:"a",name:"tool_result",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("result"in e))throw new Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:e}}},te={code:"b",name:"tool_call_streaming_start",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("toolName"in e)||typeof e.toolName!="string")throw new Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:e}}},re={code:"c",name:"tool_call_delta",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("argsTextDelta"in e)||typeof e.argsTextDelta!="string")throw new Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:e}}},ne={code:"d",name:"finish_message",parse:e=>{if(e==null||typeof e!="object"||!("finishReason"in e)||typeof e.finishReason!="string")throw new Error('"finish_message" parts expect an object with a "finishReason" property.');const t={finishReason:e.finishReason};return"usage"in e&&e.usage!=null&&typeof e.usage=="object"&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:typeof e.usage.promptTokens=="number"?e.usage.promptTokens:Number.NaN,completionTokens:typeof e.usage.completionTokens=="number"?e.usage.completionTokens:Number.NaN}),{type:"finish_message",value:t}}},ae={code:"e",name:"finish_step",parse:e=>{if(e==null||typeof e!="object"||!("finishReason"in e)||typeof e.finishReason!="string")throw new Error('"finish_step" parts expect an object with a "finishReason" property.');const t={finishReason:e.finishReason,isContinued:!1};return"usage"in e&&e.usage!=null&&typeof e.usage=="object"&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:typeof e.usage.promptTokens=="number"?e.usage.promptTokens:Number.NaN,completionTokens:typeof e.usage.completionTokens=="number"?e.usage.completionTokens:Number.NaN}),"isContinued"in e&&typeof e.isContinued=="boolean"&&(t.isContinued=e.isContinued),{type:"finish_step",value:t}}},Rt=[q,z,F,G,K,W,H,X,Y,Q,ee,te,re,ne,ae];q.code+"",z.code+"",F.code+"",G.code+"",K.code+"",W.code+"",H.code+"",X.code+"",Y.code+"",Q.code+"",ee.code+"",te.code+"",re.code+"",ne.code+"",ae.code+"";q.name+"",q.code,z.name+"",z.code,F.name+"",F.code,G.name+"",G.code,K.name+"",K.code,W.name+"",W.code,H.name+"",H.code,X.name+"",X.code,Y.name+"",Y.code,Q.name+"",Q.code,ee.name+"",ee.code,te.name+"",te.code,re.name+"",re.code,ne.name+"",ne.code,ae.name+"",ae.code;Rt.map(e=>e.code);function yn(e,t){const r=Rt.find(n=>n.name===e);if(!r)throw new Error(`Invalid stream part type: ${e}`);return`${r.code}:${JSON.stringify(t)}
`}var Se=Symbol.for("vercel.ai.schema");function hn(e,{validate:t}={}){return{[Se]:!0,_type:void 0,[Ar]:!0,jsonSchema:e,validate:t}}function vn(e){return typeof e=="object"&&e!==null&&Se in e&&e[Se]===!0&&"jsonSchema"in e&&"validate"in e}function Ct(e){return vn(e)?e:bn(e)}function bn(e){return hn(gn(e),{validate:t=>{const r=e.safeParse(t);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}}})}let _n=(e,t=21)=>(r=t)=>{let n="",a=r;for(;a--;)n+=e[Math.random()*e.length|0];return n};var Ot="vercel.ai.error",wn=Symbol.for(Ot),jt,xn=class $t extends Error{constructor({name:t,message:r,cause:n}){super(r),this[jt]=!0,this.name=t,this.cause=n}static isInstance(t){return $t.hasMarker(t,Ot)}static hasMarker(t,r){const n=Symbol.for(r);return t!=null&&typeof t=="object"&&n in t&&typeof t[n]=="boolean"&&t[n]===!0}toJSON(){return{name:this.name,message:this.message}}};jt=wn;var h=xn,Te="AI_APICallError",Dt=`vercel.ai.error.${Te}`,Sn=Symbol.for(Dt),Zt,Tn=class extends h{constructor({message:e,url:t,requestBodyValues:r,statusCode:n,responseHeaders:a,responseBody:o,cause:s,isRetryable:i=n!=null&&(n===408||n===409||n===429||n>=500),data:c}){super({name:Te,message:e,cause:s}),this[Zt]=!0,this.url=t,this.requestBodyValues=r,this.statusCode=n,this.responseHeaders=a,this.responseBody=o,this.isRetryable=i,this.data=c}static isInstance(e){return h.hasMarker(e,Dt)}static isAPICallError(e){return e instanceof Error&&e.name===Te&&typeof e.url=="string"&&typeof e.requestBodyValues=="object"&&(e.statusCode==null||typeof e.statusCode=="number")&&(e.responseHeaders==null||typeof e.responseHeaders=="object")&&(e.responseBody==null||typeof e.responseBody=="string")&&(e.cause==null||typeof e.cause=="object")&&typeof e.isRetryable=="boolean"&&(e.data==null||typeof e.data=="object")}toJSON(){return{name:this.name,message:this.message,url:this.url,requestBodyValues:this.requestBodyValues,statusCode:this.statusCode,responseHeaders:this.responseHeaders,responseBody:this.responseBody,cause:this.cause,isRetryable:this.isRetryable,data:this.data}}};Zt=Sn;function Ve(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}var ke="AI_InvalidPromptError",Ut=`vercel.ai.error.${ke}`,kn=Symbol.for(Ut),Lt,B=class extends h{constructor({prompt:e,message:t,cause:r}){super({name:ke,message:`Invalid prompt: ${t}`,cause:r}),this[Lt]=!0,this.prompt=e}static isInstance(e){return h.hasMarker(e,Ut)}static isInvalidPromptError(e){return e instanceof Error&&e.name===ke&&prompt!=null}toJSON(){return{name:this.name,message:this.message,stack:this.stack,prompt:this.prompt}}};Lt=kn;var Ie="AI_JSONParseError",Bt=`vercel.ai.error.${Ie}`,In=Symbol.for(Bt),Vt,yt=class extends h{constructor({text:e,cause:t}){super({name:Ie,message:`JSON parsing failed: Text: ${e}.
Error message: ${Ve(t)}`,cause:t}),this[Vt]=!0,this.text=e}static isInstance(e){return h.hasMarker(e,Bt)}static isJSONParseError(e){return e instanceof Error&&e.name===Ie&&"text"in e&&typeof e.text=="string"}toJSON(){return{name:this.name,message:this.message,cause:this.cause,stack:this.stack,valueText:this.text}}};Vt=In;var Ee="AI_TypeValidationError",Jt=`vercel.ai.error.${Ee}`,En=Symbol.for(Jt),qt,An=class Ae extends h{constructor({value:t,cause:r}){super({name:Ee,message:`Type validation failed: Value: ${JSON.stringify(t)}.
Error message: ${Ve(r)}`,cause:r}),this[qt]=!0,this.value=t}static isInstance(t){return h.hasMarker(t,Jt)}static wrap({value:t,cause:r}){return Ae.isInstance(r)&&r.value===t?r:new Ae({value:t,cause:r})}static isTypeValidationError(t){return t instanceof Error&&t.name===Ee}toJSON(){return{name:this.name,message:this.message,cause:this.cause,stack:this.stack,value:this.value}}};qt=En;var ht=An,Pn=({prefix:e="",size:t=7,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"}={})=>{const n=_n(r,t);return a=>`${e}${n(a)}`};function Pe(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}function Nn(e){return e instanceof Error&&(e.name==="AbortError"||e.name==="TimeoutError")}var Ne=Symbol.for("vercel.ai.validator");function Mn(e){return{[Ne]:!0,validate:e}}function Rn(e){return typeof e=="object"&&e!==null&&Ne in e&&e[Ne]===!0&&"validate"in e}function Cn(e){return Rn(e)?e:On(e)}function On(e){return Mn(t=>{const r=e.safeParse(t);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}})}function Je({value:e,schema:t}){const r=Cn(t);try{if(r.validate==null)return{success:!0,value:e};const n=r.validate(e);return n.success?n:{success:!1,error:ht.wrap({value:e,cause:n.error})}}catch(n){return{success:!1,error:ht.wrap({value:e,cause:n})}}}function jn({text:e,schema:t}){try{const r=Er.parse(e);return t==null?{success:!0,value:r}:Je({value:r,schema:t})}catch(r){return{success:!1,error:yt.isJSONParseError(r)?r:new yt({text:e,cause:r})}}}var{btoa:$n,atob:Dn}=globalThis;function Zn(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),r=Dn(t);return Uint8Array.from(r,n=>n.codePointAt(0))}function fe(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCodePoint(e[r]);return $n(t)}var Un=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{},M="1.9.0",vt=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function Ln(e){var t=new Set([e]),r=new Set,n=e.match(vt);if(!n)return function(){return!1};var a={major:+n[1],minor:+n[2],patch:+n[3],prerelease:n[4]};if(a.prerelease!=null)return function(c){return c===e};function o(i){return r.add(i),!1}function s(i){return t.add(i),!0}return function(c){if(t.has(c))return!0;if(r.has(c))return!1;var f=c.match(vt);if(!f)return o(c);var u={major:+f[1],minor:+f[2],patch:+f[3],prerelease:f[4]};return u.prerelease!=null||a.major!==u.major?o(c):a.major===0?a.minor===u.minor&&a.patch<=u.patch?s(c):o(c):a.minor<=u.minor?s(c):o(c)}}var Bn=Ln(M),Vn=M.split(".")[0],oe=Symbol.for("opentelemetry.js.api."+Vn),se=Un;function qe(e,t,r,n){var a;n===void 0&&(n=!1);var o=se[oe]=(a=se[oe])!==null&&a!==void 0?a:{version:M};if(!n&&o[e]){var s=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return r.error(s.stack||s.message),!1}if(o.version!==M){var s=new Error("@opentelemetry/api: Registration of version v"+o.version+" for "+e+" does not match previously registered API v"+M);return r.error(s.stack||s.message),!1}return o[e]=t,r.debug("@opentelemetry/api: Registered a global for "+e+" v"+M+"."),!0}function ie(e){var t,r,n=(t=se[oe])===null||t===void 0?void 0:t.version;if(!(!n||!Bn(n)))return(r=se[oe])===null||r===void 0?void 0:r[e]}function ze(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+M+".");var r=se[oe];r&&delete r[e]}var Jn=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,o=[],s;try{for(;(t===void 0||t-- >0)&&!(a=n.next()).done;)o.push(a.value)}catch(i){s={error:i}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return o},qn=function(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,o;n<a;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))},zn=function(){function e(t){this._namespace=t.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return V("debug",this._namespace,t)},e.prototype.error=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return V("error",this._namespace,t)},e.prototype.info=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return V("info",this._namespace,t)},e.prototype.warn=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return V("warn",this._namespace,t)},e.prototype.verbose=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return V("verbose",this._namespace,t)},e}();function V(e,t,r){var n=ie("diag");if(n)return r.unshift(t),n[e].apply(n,qn([],Jn(r),!1))}var w;(function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"})(w||(w={}));function Fn(e,t){e<w.NONE?e=w.NONE:e>w.ALL&&(e=w.ALL),t=t||{};function r(n,a){var o=t[n];return typeof o=="function"&&e>=a?o.bind(t):function(){}}return{error:r("error",w.ERROR),warn:r("warn",w.WARN),info:r("info",w.INFO),debug:r("debug",w.DEBUG),verbose:r("verbose",w.VERBOSE)}}var Gn=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,o=[],s;try{for(;(t===void 0||t-- >0)&&!(a=n.next()).done;)o.push(a.value)}catch(i){s={error:i}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return o},Kn=function(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,o;n<a;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))},Wn="diag",ge=function(){function e(){function t(a){return function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];var i=ie("diag");if(i)return i[a].apply(i,Kn([],Gn(o),!1))}}var r=this,n=function(a,o){var s,i,c;if(o===void 0&&(o={logLevel:w.INFO}),a===r){var f=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return r.error((s=f.stack)!==null&&s!==void 0?s:f.message),!1}typeof o=="number"&&(o={logLevel:o});var u=ie("diag"),m=Fn((i=o.logLevel)!==null&&i!==void 0?i:w.INFO,a);if(u&&!o.suppressOverrideMessage){var _=(c=new Error().stack)!==null&&c!==void 0?c:"<failed to generate stacktrace>";u.warn("Current logger will be overwritten from "+_),m.warn("Current logger will overwrite one already registered from "+_)}return qe("diag",m,r,!0)};r.setLogger=n,r.disable=function(){ze(Wn,r)},r.createComponentLogger=function(a){return new zn(a)},r.verbose=t("verbose"),r.debug=t("debug"),r.info=t("info"),r.warn=t("warn"),r.error=t("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}();function Hn(e){return Symbol.for(e)}var Xn=function(){function e(t){var r=this;r._currentContext=t?new Map(t):new Map,r.getValue=function(n){return r._currentContext.get(n)},r.setValue=function(n,a){var o=new e(r._currentContext);return o._currentContext.set(n,a),o},r.deleteValue=function(n){var a=new e(r._currentContext);return a._currentContext.delete(n),a}}return e}(),Yn=new Xn,Qn=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,o=[],s;try{for(;(t===void 0||t-- >0)&&!(a=n.next()).done;)o.push(a.value)}catch(i){s={error:i}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return o},ea=function(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,o;n<a;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))},ta=function(){function e(){}return e.prototype.active=function(){return Yn},e.prototype.with=function(t,r,n){for(var a=[],o=3;o<arguments.length;o++)a[o-3]=arguments[o];return r.call.apply(r,ea([n],Qn(a),!1))},e.prototype.bind=function(t,r){return r},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}(),ra=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,o=[],s;try{for(;(t===void 0||t-- >0)&&!(a=n.next()).done;)o.push(a.value)}catch(i){s={error:i}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return o},na=function(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,o;n<a;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))},be="context",aa=new ta,zt=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(t){return qe(be,t,ge.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(t,r,n){for(var a,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return(a=this._getContextManager()).with.apply(a,na([t,r,n],ra(o),!1))},e.prototype.bind=function(t,r){return this._getContextManager().bind(t,r)},e.prototype._getContextManager=function(){return ie(be)||aa},e.prototype.disable=function(){this._getContextManager().disable(),ze(be,ge.instance())},e}(),Me;(function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"})(Me||(Me={}));var Ft="0000000000000000",Gt="00000000000000000000000000000000",oa={traceId:Gt,spanId:Ft,traceFlags:Me.NONE},J=function(){function e(t){t===void 0&&(t=oa),this._spanContext=t}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(t,r){return this},e.prototype.setAttributes=function(t){return this},e.prototype.addEvent=function(t,r){return this},e.prototype.addLink=function(t){return this},e.prototype.addLinks=function(t){return this},e.prototype.setStatus=function(t){return this},e.prototype.updateName=function(t){return this},e.prototype.end=function(t){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(t,r){},e}(),Fe=Hn("OpenTelemetry Context Key SPAN");function Ge(e){return e.getValue(Fe)||void 0}function sa(){return Ge(zt.getInstance().active())}function Ke(e,t){return e.setValue(Fe,t)}function ia(e){return e.deleteValue(Fe)}function ua(e,t){return Ke(e,new J(t))}function Kt(e){var t;return(t=Ge(e))===null||t===void 0?void 0:t.spanContext()}var la=/^([0-9a-f]{32})$/i,ca=/^[0-9a-f]{16}$/i;function pa(e){return la.test(e)&&e!==Gt}function ma(e){return ca.test(e)&&e!==Ft}function Wt(e){return pa(e.traceId)&&ma(e.spanId)}function da(e){return new J(e)}var _e=zt.getInstance(),Ht=function(){function e(){}return e.prototype.startSpan=function(t,r,n){n===void 0&&(n=_e.active());var a=!!(r!=null&&r.root);if(a)return new J;var o=n&&Kt(n);return fa(o)&&Wt(o)?new J(o):new J},e.prototype.startActiveSpan=function(t,r,n,a){var o,s,i;if(!(arguments.length<2)){arguments.length===2?i=r:arguments.length===3?(o=r,i=n):(o=r,s=n,i=a);var c=s??_e.active(),f=this.startSpan(t,o,c),u=Ke(c,f);return _e.with(u,i,void 0,f)}},e}();function fa(e){return typeof e=="object"&&typeof e.spanId=="string"&&typeof e.traceId=="string"&&typeof e.traceFlags=="number"}var ga=new Ht,ya=function(){function e(t,r,n,a){this._provider=t,this.name=r,this.version=n,this.options=a}return e.prototype.startSpan=function(t,r,n){return this._getTracer().startSpan(t,r,n)},e.prototype.startActiveSpan=function(t,r,n,a){var o=this._getTracer();return Reflect.apply(o.startActiveSpan,o,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var t=this._provider.getDelegateTracer(this.name,this.version,this.options);return t?(this._delegate=t,this._delegate):ga},e}(),ha=function(){function e(){}return e.prototype.getTracer=function(t,r,n){return new Ht},e}(),va=new ha,bt=function(){function e(){}return e.prototype.getTracer=function(t,r,n){var a;return(a=this.getDelegateTracer(t,r,n))!==null&&a!==void 0?a:new ya(this,t,r,n)},e.prototype.getDelegate=function(){var t;return(t=this._delegate)!==null&&t!==void 0?t:va},e.prototype.setDelegate=function(t){this._delegate=t},e.prototype.getDelegateTracer=function(t,r,n){var a;return(a=this._delegate)===null||a===void 0?void 0:a.getTracer(t,r,n)},e}(),ye;(function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"})(ye||(ye={}));var we="trace",ba=function(){function e(){this._proxyTracerProvider=new bt,this.wrapSpanContext=da,this.isSpanContextValid=Wt,this.deleteSpan=ia,this.getSpan=Ge,this.getActiveSpan=sa,this.getSpanContext=Kt,this.setSpan=Ke,this.setSpanContext=ua}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(t){var r=qe(we,this._proxyTracerProvider,ge.instance());return r&&this._proxyTracerProvider.setDelegate(t),r},e.prototype.getTracerProvider=function(){return ie(we)||this._proxyTracerProvider},e.prototype.getTracer=function(t,r){return this.getTracerProvider().getTracer(t,r)},e.prototype.disable=function(){ze(we,ge.instance()),this._proxyTracerProvider=new bt},e}(),_a=ba.getInstance(),wa=Object.defineProperty,Xt=(e,t)=>{for(var r in t)wa(e,r,{get:t[r],enumerable:!0})};async function xa(e){return e===void 0?Promise.resolve():new Promise(t=>setTimeout(t,e))}var Re="AI_RetryError",Yt=`vercel.ai.error.${Re}`,Sa=Symbol.for(Yt),Qt,_t=class extends h{constructor({message:e,reason:t,errors:r}){super({name:Re,message:e}),this[Qt]=!0,this.reason=t,this.errors=r,this.lastError=r[r.length-1]}static isInstance(e){return h.hasMarker(e,Yt)}static isRetryError(e){return e instanceof Error&&e.name===Re&&typeof e.reason=="string"&&Array.isArray(e.errors)}toJSON(){return{name:this.name,message:this.message,reason:this.reason,lastError:this.lastError,errors:this.errors}}};Qt=Sa;var Ta=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:r=2}={})=>async n=>er(n,{maxRetries:e,delayInMs:t,backoffFactor:r});async function er(e,{maxRetries:t,delayInMs:r,backoffFactor:n},a=[]){try{return await e()}catch(o){if(Nn(o)||t===0)throw o;const s=Pe(o),i=[...a,o],c=i.length;if(c>t)throw new _t({message:`Failed after ${c} attempts. Last error: ${s}`,reason:"maxRetriesExceeded",errors:i});if(o instanceof Error&&Tn.isAPICallError(o)&&o.isRetryable===!0&&c<=t)return await xa(r),er(e,{maxRetries:t,delayInMs:n*r,backoffFactor:n},i);throw c===1?o:new _t({message:`Failed after ${c} attempts with non-retryable error: '${s}'`,reason:"errorNotRetryable",errors:i})}}function Ce({operationId:e,telemetry:t}){return{"operation.name":`${e}${(t==null?void 0:t.functionId)!=null?` ${t.functionId}`:""}`,"resource.name":t==null?void 0:t.functionId,"ai.operationId":e,"ai.telemetry.functionId":t==null?void 0:t.functionId}}function ka({model:e,settings:t,telemetry:r,headers:n}){var a;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((o,[s,i])=>(o[`ai.settings.${s}`]=i,o),{}),...Object.entries((a=r==null?void 0:r.metadata)!=null?a:{}).reduce((o,[s,i])=>(o[`ai.telemetry.metadata.${s}`]=i,o),{}),...Object.entries(n??{}).reduce((o,[s,i])=>(i!==void 0&&(o[`ai.request.headers.${s}`]=i),o),{})}}var Ia={startSpan(){return pe},startActiveSpan(e,t,r,n){if(typeof t=="function")return t(pe);if(typeof r=="function")return r(pe);if(typeof n=="function")return n(pe)}},pe={spanContext(){return Ea},setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording(){return!1},recordException(){return this}},Ea={traceId:"",spanId:"",traceFlags:0};function Aa({isEnabled:e}){return e?_a.getTracer("ai"):Ia}function Oe({name:e,tracer:t,attributes:r,fn:n,endWhenDone:a=!0}){return t.startActiveSpan(e,{attributes:r},async o=>{try{const s=await n(o);return a&&o.end(),s}catch(s){try{s instanceof Error?(o.recordException({name:s.name,message:s.message,stack:s.stack}),o.setStatus({code:ye.ERROR,message:s.message})):o.setStatus({code:ye.ERROR})}finally{o.end()}throw s}})}function $({telemetry:e,attributes:t}){return Object.entries(t).reduce((r,[n,a])=>{if(a===void 0)return r;if(typeof a=="object"&&"input"in a&&typeof a.input=="function"){if((e==null?void 0:e.recordInputs)===!1)return r;const o=a.input();return o===void 0?r:{...r,[n]:o}}if(typeof a=="object"&&"output"in a&&typeof a.output=="function"){if((e==null?void 0:e.recordOutputs)===!1)return r;const o=a.output();return o===void 0?r:{...r,[n]:o}}return{...r,[n]:a}},{})}var je="AI_DownloadError",tr=`vercel.ai.error.${je}`,Pa=Symbol.for(tr),rr,xe=class extends h{constructor({url:e,statusCode:t,statusText:r,cause:n,message:a=n==null?`Failed to download ${e}: ${t} ${r}`:`Failed to download ${e}: ${n}`}){super({name:je,message:a,cause:n}),this[rr]=!0,this.url=e,this.statusCode=t,this.statusText=r}static isInstance(e){return h.hasMarker(e,tr)}static isDownloadError(e){return e instanceof Error&&e.name===je&&typeof e.url=="string"&&(e.statusCode==null||typeof e.statusCode=="number")&&(e.statusText==null||typeof e.statusText=="string")}toJSON(){return{name:this.name,message:this.message,url:this.url,statusCode:this.statusCode,statusText:this.statusText,cause:this.cause}}};rr=Pa;async function Na({url:e,fetchImplementation:t=fetch}){var r;const n=e.toString();try{const a=await t(n);if(!a.ok)throw new xe({url:n,statusCode:a.status,statusText:a.statusText});return{data:new Uint8Array(await a.arrayBuffer()),mimeType:(r=a.headers.get("content-type"))!=null?r:void 0}}catch(a){throw xe.isInstance(a)?a:new xe({url:n,cause:a})}}var Ma=[{mimeType:"image/gif",bytes:[71,73,70]},{mimeType:"image/png",bytes:[137,80,78,71]},{mimeType:"image/jpeg",bytes:[255,216]},{mimeType:"image/webp",bytes:[82,73,70,70]}];function Ra(e){for(const{bytes:t,mimeType:r}of Ma)if(e.length>=t.length&&t.every((n,a)=>e[a]===n))return r}var $e="AI_InvalidDataContentError",nr=`vercel.ai.error.${$e}`,Ca=Symbol.for(nr),ar,wt=class extends h{constructor({content:e,cause:t,message:r=`Invalid data content. Expected a base64 string, Uint8Array, ArrayBuffer, or Buffer, but got ${typeof e}.`}){super({name:$e,message:r,cause:t}),this[ar]=!0,this.content=e}static isInstance(e){return h.hasMarker(e,nr)}static isInvalidDataContentError(e){return e instanceof Error&&e.name===$e&&e.content!=null}toJSON(){return{name:this.name,message:this.message,stack:this.stack,cause:this.cause,content:this.content}}};ar=Ca;var or=l.union([l.string(),l.instanceof(Uint8Array),l.instanceof(ArrayBuffer),l.custom(e=>{var t,r;return(r=(t=globalThis.Buffer)==null?void 0:t.isBuffer(e))!=null?r:!1},{message:"Must be a Buffer"})]);function xt(e){return typeof e=="string"?e:e instanceof ArrayBuffer?fe(new Uint8Array(e)):fe(e)}function St(e){if(e instanceof Uint8Array)return e;if(typeof e=="string")try{return Zn(e)}catch(t){throw new wt({message:"Invalid data content. Content string is not a base64-encoded media.",content:e,cause:t})}if(e instanceof ArrayBuffer)return new Uint8Array(e);throw new wt({content:e})}var De="AI_InvalidMessageRoleError",sr=`vercel.ai.error.${De}`,Oa=Symbol.for(sr),ir,ja=class extends h{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:De,message:t}),this[ir]=!0,this.role=e}static isInstance(e){return h.hasMarker(e,sr)}static isInvalidMessageRoleError(e){return e instanceof Error&&e.name===De&&typeof e.role=="string"}toJSON(){return{name:this.name,message:this.message,stack:this.stack,role:this.role}}};ir=Oa;function Tt(e){try{const[t,r]=e.split(",");return{mimeType:t.split(";")[0].split(":")[1],base64Content:r}}catch{return{mimeType:void 0,base64Content:void 0}}}async function $a({prompt:e,modelSupportsImageUrls:t=!0,downloadImplementation:r=Na}){const n=[];e.system!=null&&n.push({role:"system",content:e.system});const a=t||e.messages==null?null:await Da(e.messages,r),o=e.type;switch(o){case"prompt":{n.push({role:"user",content:[{type:"text",text:e.prompt}]});break}case"messages":{n.push(...e.messages.map(s=>me(s,a)));break}default:{const s=o;throw new Error(`Unsupported prompt type: ${s}`)}}return n}function me(e,t){const r=e.role;switch(r){case"system":return{role:"system",content:e.content,providerMetadata:e.experimental_providerMetadata};case"user":return typeof e.content=="string"?{role:"user",content:[{type:"text",text:e.content}],providerMetadata:e.experimental_providerMetadata}:{role:"user",content:e.content.map(n=>{var a,o,s,i,c;switch(n.type){case"text":return{type:"text",text:n.text,providerMetadata:n.experimental_providerMetadata};case"image":{if(n.image instanceof URL){if(t==null)return{type:"image",image:n.image,mimeType:n.mimeType,providerMetadata:n.experimental_providerMetadata};{const u=t[n.image.toString()];return{type:"image",image:u.data,mimeType:(a=n.mimeType)!=null?a:u.mimeType,providerMetadata:n.experimental_providerMetadata}}}if(typeof n.image=="string")try{const u=new URL(n.image);switch(u.protocol){case"http:":case"https:":{if(t==null)return{type:"image",image:u,mimeType:n.mimeType,providerMetadata:n.experimental_providerMetadata};{const m=t[u.toString()];return{type:"image",image:m.data,mimeType:(o=n.mimeType)!=null?o:m.mimeType,providerMetadata:n.experimental_providerMetadata}}}case"data:":try{const{mimeType:m,base64Content:_}=Tt(n.image);if(m==null||_==null)throw new Error("Invalid data URL format");return{type:"image",image:St(_),mimeType:m,providerMetadata:n.experimental_providerMetadata}}catch{throw new Error(`Error processing data URL: ${Pe(e)}`)}}}catch{}const f=St(n.image);return{type:"image",image:f,mimeType:(s=n.mimeType)!=null?s:Ra(f),providerMetadata:n.experimental_providerMetadata}}case"file":{if(n.data instanceof URL){if(t==null)return{type:"file",data:n.data,mimeType:n.mimeType,providerMetadata:n.experimental_providerMetadata};{const u=t[n.data.toString()];return{type:"file",data:fe(u.data),mimeType:(i=n.mimeType)!=null?i:u.mimeType,providerMetadata:n.experimental_providerMetadata}}}if(typeof n.data=="string")try{const u=new URL(n.data);switch(u.protocol){case"http:":case"https:":{if(t==null)return{type:"file",data:u,mimeType:n.mimeType,providerMetadata:n.experimental_providerMetadata};{const m=t[u.toString()];return{type:"file",data:fe(m.data),mimeType:(c=n.mimeType)!=null?c:m.mimeType,providerMetadata:n.experimental_providerMetadata}}}case"data:":try{const{mimeType:m,base64Content:_}=Tt(n.data);if(m==null||_==null)throw new Error("Invalid data URL format");return{type:"file",data:xt(_),mimeType:m,providerMetadata:n.experimental_providerMetadata}}catch{throw new Error(`Error processing data URL: ${Pe(e)}`)}}}catch{}return{type:"file",data:xt(n.data),mimeType:n.mimeType,providerMetadata:n.experimental_providerMetadata}}}}).filter(n=>n.type!=="text"||n.text!==""),providerMetadata:e.experimental_providerMetadata};case"assistant":return typeof e.content=="string"?{role:"assistant",content:[{type:"text",text:e.content}],providerMetadata:e.experimental_providerMetadata}:{role:"assistant",content:e.content.filter(n=>n.type!=="text"||n.text!=="").map(n=>{const{experimental_providerMetadata:a,...o}=n;return{...o,providerMetadata:a}}),providerMetadata:e.experimental_providerMetadata};case"tool":return{role:"tool",content:e.content.map(n=>({type:"tool-result",toolCallId:n.toolCallId,toolName:n.toolName,result:n.result,providerMetadata:n.experimental_providerMetadata})),providerMetadata:e.experimental_providerMetadata};default:{const n=r;throw new ja({role:n})}}}async function Da(e,t){const r=e.filter(a=>a.role==="user").map(a=>a.content).filter(a=>Array.isArray(a)).flat().filter(a=>a.type==="image"||a.type==="file").map(a=>a.type==="image"?a.image:a.data).map(a=>typeof a=="string"&&(a.startsWith("http:")||a.startsWith("https:"))?new URL(a):a).filter(a=>a instanceof URL),n=await Promise.all(r.map(async a=>({url:a,data:await t({url:a})})));return Object.fromEntries(n.map(({url:a,data:o})=>[a.toString(),o]))}var Ze="AI_InvalidArgumentError",ur=`vercel.ai.error.${Ze}`,Za=Symbol.for(ur),lr,T=class extends h{constructor({parameter:e,value:t,message:r}){super({name:Ze,message:`Invalid argument for parameter ${e}: ${r}`}),this[lr]=!0,this.parameter=e,this.value=t}static isInstance(e){return h.hasMarker(e,ur)}static isInvalidArgumentError(e){return e instanceof Error&&e.name===Ze&&typeof e.parameter=="string"&&typeof e.value=="string"}toJSON(){return{name:this.name,message:this.message,stack:this.stack,parameter:this.parameter,value:this.value}}};lr=Za;function Ua({maxTokens:e,temperature:t,topP:r,topK:n,presencePenalty:a,frequencyPenalty:o,stopSequences:s,seed:i,maxRetries:c}){if(e!=null){if(!Number.isInteger(e))throw new T({parameter:"maxTokens",value:e,message:"maxTokens must be an integer"});if(e<1)throw new T({parameter:"maxTokens",value:e,message:"maxTokens must be >= 1"})}if(t!=null&&typeof t!="number")throw new T({parameter:"temperature",value:t,message:"temperature must be a number"});if(r!=null&&typeof r!="number")throw new T({parameter:"topP",value:r,message:"topP must be a number"});if(n!=null&&typeof n!="number")throw new T({parameter:"topK",value:n,message:"topK must be a number"});if(a!=null&&typeof a!="number")throw new T({parameter:"presencePenalty",value:a,message:"presencePenalty must be a number"});if(o!=null&&typeof o!="number")throw new T({parameter:"frequencyPenalty",value:o,message:"frequencyPenalty must be a number"});if(i!=null&&!Number.isInteger(i))throw new T({parameter:"seed",value:i,message:"seed must be an integer"});if(c!=null){if(!Number.isInteger(c))throw new T({parameter:"maxRetries",value:c,message:"maxRetries must be an integer"});if(c<0)throw new T({parameter:"maxRetries",value:c,message:"maxRetries must be >= 0"})}return{maxTokens:e,temperature:t??0,topP:r,topK:n,presencePenalty:a,frequencyPenalty:o,stopSequences:s!=null&&s.length>0?s:void 0,seed:i,maxRetries:c??2}}var Ue=l.lazy(()=>l.union([l.null(),l.string(),l.number(),l.boolean(),l.record(l.string(),Ue),l.array(Ue)])),A=l.record(l.string(),l.record(l.string(),Ue)),cr=l.object({type:l.literal("text"),text:l.string(),experimental_providerMetadata:A.optional()}),La=l.object({type:l.literal("image"),image:l.union([or,l.instanceof(URL)]),mimeType:l.string().optional(),experimental_providerMetadata:A.optional()}),Ba=l.object({type:l.literal("file"),data:l.union([or,l.instanceof(URL)]),mimeType:l.string(),experimental_providerMetadata:A.optional()}),Va=l.object({type:l.literal("tool-call"),toolCallId:l.string(),toolName:l.string(),args:l.unknown()}),Ja=l.object({type:l.literal("tool-result"),toolCallId:l.string(),toolName:l.string(),result:l.unknown(),isError:l.boolean().optional(),experimental_providerMetadata:A.optional()}),qa=l.object({role:l.literal("system"),content:l.string(),experimental_providerMetadata:A.optional()}),za=l.object({role:l.literal("user"),content:l.union([l.string(),l.array(l.union([cr,La,Ba]))]),experimental_providerMetadata:A.optional()}),Fa=l.object({role:l.literal("assistant"),content:l.union([l.string(),l.array(l.union([cr,Va]))]),experimental_providerMetadata:A.optional()}),Ga=l.object({role:l.literal("tool"),content:l.array(Ja),experimental_providerMetadata:A.optional()}),Ka=l.union([qa,za,Fa,Ga]);function Wa(e){if(e.prompt==null&&e.messages==null)throw new B({prompt:e,message:"prompt or messages must be defined"});if(e.prompt!=null&&e.messages!=null)throw new B({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(e.system!=null&&typeof e.system!="string")throw new B({prompt:e,message:"system must be a string"});if(e.prompt!=null){if(typeof e.prompt!="string")throw new B({prompt:e,message:"prompt must be a string"});return{type:"prompt",prompt:e.prompt,messages:void 0,system:e.system}}if(e.messages!=null){const t=Je({value:e.messages,schema:l.array(Ka)});if(!t.success)throw new B({prompt:e,message:"messages must be an array of CoreMessage",cause:t.error});return{type:"messages",prompt:void 0,messages:e.messages,system:e.system}}throw new Error("unreachable")}function Ha(e){return{promptTokens:e.promptTokens,completionTokens:e.completionTokens,totalTokens:e.promptTokens+e.completionTokens}}function pr(e,{contentType:t,dataStreamVersion:r}){var n;const a=new Headers((n=e==null?void 0:e.headers)!=null?n:{});return a.has("Content-Type")||a.set("Content-Type",t),r!==void 0&&a.set("X-Vercel-AI-Data-Stream",r),a}var Le="AI_InvalidToolArgumentsError",mr=`vercel.ai.error.${Le}`,Xa=Symbol.for(mr),dr,Ya=class extends h{constructor({toolArgs:e,toolName:t,cause:r,message:n=`Invalid arguments for tool ${t}: ${Ve(r)}`}){super({name:Le,message:n,cause:r}),this[dr]=!0,this.toolArgs=e,this.toolName=t}static isInstance(e){return h.hasMarker(e,mr)}static isInvalidToolArgumentsError(e){return e instanceof Error&&e.name===Le&&typeof e.toolName=="string"&&typeof e.toolArgs=="string"}toJSON(){return{name:this.name,message:this.message,cause:this.cause,stack:this.stack,toolName:this.toolName,toolArgs:this.toolArgs}}};dr=Xa;var Be="AI_NoSuchToolError",fr=`vercel.ai.error.${Be}`,Qa=Symbol.for(fr),gr,kt=class extends h{constructor({toolName:e,availableTools:t=void 0,message:r=`Model tried to call unavailable tool '${e}'. ${t===void 0?"No tools are available.":`Available tools: ${t.join(", ")}.`}`}){super({name:Be,message:r}),this[gr]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return h.hasMarker(e,fr)}static isNoSuchToolError(e){return e instanceof Error&&e.name===Be&&"toolName"in e&&e.toolName!=null&&typeof e.name=="string"}toJSON(){return{name:this.name,message:this.message,stack:this.stack,toolName:this.toolName,availableTools:this.availableTools}}};gr=Qa;function eo(e){return e!=null&&Object.keys(e).length>0}function to({tools:e,toolChoice:t}){return eo(e)?{tools:Object.entries(e).map(([r,n])=>({type:"function",name:r,description:n.description,parameters:Ct(n.parameters).jsonSchema})),toolChoice:t==null?{type:"auto"}:typeof t=="string"?{type:t}:{type:"tool",toolName:t.toolName}}:{tools:void 0,toolChoice:void 0}}var ro=/^([\s\S]*?)(\s+)(\S*)$/;function no(e){const t=e.match(ro);return t?{prefix:t[1],whitespace:t[2],suffix:t[3]}:void 0}function ao(e){const t=no(e);return t?t.prefix+t.whitespace:e}function oo({toolCall:e,tools:t}){const r=e.toolName;if(t==null)throw new kt({toolName:e.toolName});const n=t[r];if(n==null)throw new kt({toolName:e.toolName,availableTools:Object.keys(t)});const a=Ct(n.parameters),o=e.args.trim()===""?Je({value:{},schema:a}):jn({text:e.args,schema:a});if(o.success===!1)throw new Ya({toolName:r,toolArgs:e.args,cause:o.error});return{type:"tool-call",toolCallId:e.toolCallId,toolName:r,args:o.value}}function It({text:e="",toolCalls:t,toolResults:r}){const n=[];return n.push({role:"assistant",content:[{type:"text",text:e},...t]}),r.length>0&&n.push({role:"tool",content:r.map(a=>({type:"tool-result",toolCallId:a.toolCallId,toolName:a.toolName,result:a.result}))}),n}var so=Pn({prefix:"aitxt-",size:24});async function _o({model:e,tools:t,toolChoice:r,system:n,prompt:a,messages:o,maxRetries:s,abortSignal:i,headers:c,maxAutomaticRoundtrips:f=0,maxToolRoundtrips:u=f,maxSteps:m=u!=null?u+1:1,experimental_continuationSteps:_,experimental_continueSteps:D=_??!1,experimental_telemetry:k,experimental_providerMetadata:_r,_internal:{generateId:wr=so,currentDate:xr=()=>new Date}={},onStepFinish:He,...I}){var Xe;if(m<1)throw new T({parameter:"maxSteps",value:m,message:"maxSteps must be at least 1"});const Ye=ka({model:e,telemetry:k,headers:c,settings:{...I,maxRetries:s}}),he=Aa({isEnabled:(Xe=k==null?void 0:k.isEnabled)!=null?Xe:!1});return Oe({name:"ai.generateText",attributes:$({telemetry:k,attributes:{...Ce({operationId:"ai.generateText",telemetry:k}),...Ye,"ai.prompt":{input:()=>JSON.stringify({system:n,prompt:a,messages:o})},"ai.settings.maxSteps":m}}),tracer:he,fn:async Sr=>{var Qe,et,tt,rt,nt;const Tr=Ta({maxRetries:s}),at=Wa({system:n,prompt:a,messages:o}),kr={type:"regular",...to({tools:t,toolChoice:r})},Ir=Ua(I),R=await $a({prompt:at,modelSupportsImageUrls:e.supportsImageUrls});let y,E=[],C=[],ot=0;const Z=[];let U="";const st=[],ue={completionTokens:0,promptTokens:0,totalTokens:0};let L="initial";do{const it=ot===0?at.type:"messages";y=await Tr(()=>Oe({name:"ai.generateText.doGenerate",attributes:$({telemetry:k,attributes:{...Ce({operationId:"ai.generateText.doGenerate",telemetry:k}),...Ye,"ai.prompt.format":{input:()=>it},"ai.prompt.messages":{input:()=>JSON.stringify(R)},"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":I.frequencyPenalty,"gen_ai.request.max_tokens":I.maxTokens,"gen_ai.request.presence_penalty":I.presencePenalty,"gen_ai.request.stop_sequences":I.stopSequences,"gen_ai.request.temperature":I.temperature,"gen_ai.request.top_k":I.topK,"gen_ai.request.top_p":I.topP}}),tracer:he,fn:async v=>{var O,lt,ct,pt,mt,dt;const b=await e.doGenerate({mode:kr,...Ir,inputFormat:it,prompt:R,providerMetadata:_r,abortSignal:i,headers:c}),j={id:(lt=(O=b.response)==null?void 0:O.id)!=null?lt:wr(),timestamp:(pt=(ct=b.response)==null?void 0:ct.timestamp)!=null?pt:xr(),modelId:(dt=(mt=b.response)==null?void 0:mt.modelId)!=null?dt:e.modelId};return v.setAttributes($({telemetry:k,attributes:{"ai.response.finishReason":b.finishReason,"ai.response.text":{output:()=>b.text},"ai.response.toolCalls":{output:()=>JSON.stringify(b.toolCalls)},"ai.response.id":j.id,"ai.response.model":j.modelId,"ai.response.timestamp":j.timestamp.toISOString(),"ai.usage.promptTokens":b.usage.promptTokens,"ai.usage.completionTokens":b.usage.completionTokens,"ai.finishReason":b.finishReason,"ai.result.text":{output:()=>b.text},"ai.result.toolCalls":{output:()=>JSON.stringify(b.toolCalls)},"gen_ai.response.finish_reasons":[b.finishReason],"gen_ai.response.id":j.id,"gen_ai.response.model":j.modelId,"gen_ai.usage.input_tokens":b.usage.promptTokens,"gen_ai.usage.output_tokens":b.usage.completionTokens}})),{...b,response:j}}})),E=((Qe=y.toolCalls)!=null?Qe:[]).map(v=>oo({toolCall:v,tools:t})),C=t==null?[]:await io({toolCalls:E,tools:t,tracer:he,telemetry:k});const le=Ha(y.usage);ue.completionTokens+=le.completionTokens,ue.promptTokens+=le.promptTokens,ue.totalTokens+=le.totalTokens;let P="done";++ot<m&&(D&&y.finishReason==="length"&&E.length===0?P="continue":E.length>0&&C.length===E.length&&(P="tool-result"));const ce=P==="continue"?ao((et=y.text)!=null?et:""):(tt=y.text)!=null?tt:"";U=P==="continue"||L==="continue"?U+ce:ce;const ut={stepType:L,text:ce,toolCalls:E,toolResults:C,finishReason:y.finishReason,usage:le,warnings:y.warnings,logprobs:y.logprobs,response:{...y.response,headers:(rt=y.rawResponse)==null?void 0:rt.headers},experimental_providerMetadata:y.providerMetadata,isContinued:P==="continue"};if(st.push(ut),await(He==null?void 0:He(ut)),L==="continue"){const v=Z.pop();R.pop(),typeof v.content=="string"?v.content=U:v.content.push({text:ce,type:"text"}),Z.push(v),R.push(me(v,null))}else if(P==="continue"){const v=It({text:U,toolCalls:E,toolResults:C});Z.push(...v),R.push(...v.map(O=>me(O,null)))}else{const v=It({text:y.text,toolCalls:E,toolResults:C});Z.push(...v),R.push(...v.map(O=>me(O,null)))}L=P}while(L!=="done");return Sr.setAttributes($({telemetry:k,attributes:{"ai.response.finishReason":y.finishReason,"ai.response.text":{output:()=>y.text},"ai.response.toolCalls":{output:()=>JSON.stringify(y.toolCalls)},"ai.usage.promptTokens":y.usage.promptTokens,"ai.usage.completionTokens":y.usage.completionTokens,"ai.finishReason":y.finishReason,"ai.result.text":{output:()=>y.text},"ai.result.toolCalls":{output:()=>JSON.stringify(y.toolCalls)}}})),new uo({text:U,toolCalls:E,toolResults:C,finishReason:y.finishReason,usage:ue,warnings:y.warnings,response:{...y.response,headers:(nt=y.rawResponse)==null?void 0:nt.headers},logprobs:y.logprobs,responseMessages:Z,steps:st,providerMetadata:y.providerMetadata})}})}async function io({toolCalls:e,tools:t,tracer:r,telemetry:n}){return(await Promise.all(e.map(async o=>{const s=t[o.toolName];if((s==null?void 0:s.execute)==null)return;const i=await Oe({name:"ai.toolCall",attributes:$({telemetry:n,attributes:{...Ce({operationId:"ai.toolCall",telemetry:n}),"ai.toolCall.name":o.toolName,"ai.toolCall.id":o.toolCallId,"ai.toolCall.args":{output:()=>JSON.stringify(o.args)}}}),tracer:r,fn:async c=>{const f=await s.execute(o.args);try{c.setAttributes($({telemetry:n,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(f)}}}))}catch{}return f}});return{toolCallId:o.toolCallId,toolName:o.toolName,args:o.args,result:i}}))).filter(o=>o!=null)}var uo=class{constructor(e){this.text=e.text,this.toolCalls=e.toolCalls,this.toolResults=e.toolResults,this.finishReason=e.finishReason,this.usage=e.usage,this.warnings=e.warnings,this.response=e.response,this.responseMessages=e.responseMessages,this.roundtrips=e.steps,this.steps=e.steps,this.experimental_providerMetadata=e.providerMetadata,this.rawResponse={headers:e.response.headers},this.logprobs=e.logprobs}};function yr(e,t){const r=e.getReader(),n=t.getReader();let a,o,s=!1,i=!1;async function c(u){try{a==null&&(a=r.read());const m=await a;a=void 0,m.done?u.close():u.enqueue(m.value)}catch(m){u.error(m)}}async function f(u){try{o==null&&(o=n.read());const m=await o;o=void 0,m.done?u.close():u.enqueue(m.value)}catch(m){u.error(m)}}return new ReadableStream({async pull(u){try{if(s){await f(u);return}if(i){await c(u);return}a==null&&(a=r.read()),o==null&&(o=n.read());const{result:m,reader:_}=await Promise.race([a.then(D=>({result:D,reader:r})),o.then(D=>({result:D,reader:n}))]);m.done||u.enqueue(m.value),_===r?(a=void 0,m.done&&(await f(u),s=!0)):(o=void 0,m.done&&(i=!0,await c(u)))}catch(m){u.error(m)}},cancel(){r.cancel(),n.cancel()}})}function hr(e){const t=new TextEncoder;let r="";const n=e||{};return new TransformStream({async start(){n.onStart&&await n.onStart()},async transform(a,o){const s=typeof a=="string"?a:a.content;o.enqueue(t.encode(s)),r+=s,n.onToken&&await n.onToken(s),n.onText&&typeof a=="string"&&await n.onText(a)},async flush(){const a=lo(n);n.onCompletion&&await n.onCompletion(r),n.onFinal&&!a&&await n.onFinal(r)}})}function lo(e){return"experimental_onFunctionCall"in e}function co(){let e=!0;return t=>(e&&(t=t.trimStart(),t&&(e=!1)),t)}function vr(){const e=new TextEncoder,t=new TextDecoder;return new TransformStream({transform:async(r,n)=>{const a=t.decode(r);n.enqueue(e.encode(yn("text",a)))}})}new TextDecoder("utf-8");var po={};Xt(po,{toAIStream:()=>mo,toDataStream:()=>We,toDataStreamResponse:()=>fo});function mo(e,t){return We(e,t)}function We(e,t){return e.pipeThrough(new TransformStream({transform:async(r,n)=>{var a;if(typeof r=="string"){n.enqueue(r);return}if("event"in r){r.event==="on_chat_model_stream"&&Et((a=r.data)==null?void 0:a.chunk,n);return}Et(r,n)}})).pipeThrough(hr(t)).pipeThrough(vr())}function fo(e,t){var r;const n=We(e,t==null?void 0:t.callbacks),a=t==null?void 0:t.data,o=t==null?void 0:t.init,s=a?yr(a.stream,n):n;return new Response(s,{status:(r=o==null?void 0:o.status)!=null?r:200,statusText:o==null?void 0:o.statusText,headers:pr(o,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function Et(e,t){if(typeof e.content=="string")t.enqueue(e.content);else{const r=e.content;for(const n of r)n.type==="text"&&t.enqueue(n.text)}}var go={};Xt(go,{toDataStream:()=>br,toDataStreamResponse:()=>yo});function br(e,t){return ho(e).pipeThrough(hr(t)).pipeThrough(vr())}function yo(e,t={}){var r;const{init:n,data:a,callbacks:o}=t,s=br(e,o),i=a?yr(a.stream,s):s;return new Response(i,{status:(r=n==null?void 0:n.status)!=null?r:200,statusText:n==null?void 0:n.statusText,headers:pr(n,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function ho(e){const t=e[Symbol.asyncIterator](),r=co();return new ReadableStream({async pull(n){var a;const{value:o,done:s}=await t.next();if(s){n.close();return}const i=r((a=o.delta)!=null?a:"");i&&n.enqueue(i)}})}export{h as AISDKError,Tn as APICallError,xe as DownloadError,T as InvalidArgumentError,wt as InvalidDataContentError,ja as InvalidMessageRoleError,B as InvalidPromptError,Ya as InvalidToolArgumentsError,yt as JSONParseError,po as LangChainAdapter,go as LlamaIndexAdapter,kt as NoSuchToolError,_t as RetryError,ht as TypeValidationError,hr as createCallbacksTransformer,vr as createStreamDataTransformer,yn as formatStreamPart,_o as generateText,hn as jsonSchema,co as trimStartOfStreamHelper};
